<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Multi-AI Chat</title>
  <style>
    body { background: #121212; color: #e0e0e0; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    #chat-container { max-width: 650px; width: 95%; background: #1f1f1f; padding: 20px; border-radius: 12px; display:flex; flex-direction:column; height:85vh; box-shadow:0 0 20px rgba(0,0,0,0.5);}
    h1 { margin:0; }
    #chat { flex:1; overflow-y:auto; margin:15px 0; padding:15px; background:#121212; border-radius:8px; border:1px solid #333; }
    .message { margin-bottom:12px; padding:10px; border-radius:8px; position:relative; white-space:pre-wrap; word-break:break-word; }
    .user { background:#263238; color:#90caf9; text-align:right; }
    .ai { background:#1b4332; color:#a5d6a7; text-align:left; }
    .copy-btn { position:absolute; top:5px; right:5px; background:#555; border:none; border-radius:4px; padding:2px 6px; font-size:0.8rem; cursor:pointer; display:none; }
    .message.ai:hover .copy-btn { display:block; }
    #input-area { display:flex; gap:10px; }
    #message { flex:1; padding:10px; border-radius:8px; border:none; background:#2e2e2e; color:#e0e0e0; }
    #send { padding:10px 18px; border:none; border-radius:8px; background:#90caf9; color:#121212; cursor:pointer; font-weight:bold; }
    #send:hover { background:#64b5f6; }
    .typing { font-style:italic; opacity:0.7; }
  </style>
</head>
<body>
  <div id="chat-container">
    <h1>Multi-AI Chat (DeepSeek R1-0528)</h1>
    <div id="chat">
      <div class="message ai">Hello! I'm your AI assistant. Let's chat.</div>
    </div>
    <div id="input-area">
      <input type="text" id="message" placeholder="Type a messageâ€¦" autocomplete="off" />
      <button id="send">Send</button>
    </div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const messageInput = document.getElementById('message');
    const sendBtn = document.getElementById('send');

    function appendMessage(text, sender, withCopy = false) {
      const div = document.createElement('div');
      div.className = `message ${sender}`;
      div.textContent = text;
      if (withCopy) {
        const btn = document.createElement('button');
        btn.className = 'copy-btn';
        btn.textContent = 'Copy';
        btn.onclick = () => navigator.clipboard.writeText(text);
        div.appendChild(btn);
      }
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      return div;
    }

    async function typeText(el, text, delay = 25) {
      el.textContent = '';
      for (let ch of text) {
        el.textContent += ch;
        chat.scrollTop = chat.scrollHeight;
        await new Promise(r => setTimeout(r, delay));
      }
    }

    async function sendMessage() {
      const msg = messageInput.value.trim();
      if (!msg) return;
      appendMessage(msg, 'user');
      messageInput.value = '';

      const typing = appendMessage('AI is typing...', 'ai');
      typing.classList.add('typing');

      try {
        const res = await fetch('/api/chat', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ message: msg })
        });
        const data = await res.json();
        typing.remove();
        const aiDiv = appendMessage('', 'ai', true);
        await typeText(aiDiv, data.response || 'Error: no reply');
      } catch(err) {
        typing.remove();
        appendMessage('Error contacting AI API.', 'ai', true);
      }
    }

    sendBtn.addEventListener('click', sendMessage);
    messageInput.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });
  </script>
</body>
</html>
